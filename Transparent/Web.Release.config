<?xml version="1.0"?>

<!-- For more information on using Web.config transformation visit http://go.microsoft.com/fwlink/?LinkId=125889 -->

<configuration xmlns:xdt="http://schemas.microsoft.com/XML-Document-Transform">
  <!--
    In the example below, the "SetAttributes" transform will change the value of 
    "connectionString" to use "ReleaseSQLServer" only when the "Match" locator 
    finds an atrribute "name" that has a value of "MyDB".
    
    <connectionStrings>
      <add name="MyDB" 
        connectionString="Data Source=ReleaseSQLServer;Initial Catalog=MyReleaseDB;Integrated Security=True" 
        xdt:Transform="SetAttributes" xdt:Locator="Match(name)"/>
    </connectionStrings>
  -->
  <appSettings xdt:Transform="Replace">
    <add key="webpages:Version" value="2.0.0.0" />
    <add key="webpages:Enabled" value="false" />
    <add key="PreserveLoginUrl" value="true" />
    <add key="ClientValidationEnabled" value="true" />
    <add key="UnobtrusiveJavaScriptEnabled" value="true" />

    <!-- General -->
    <add key="CurrentSubgoal" value="Increase the number of registered users to 100,000" />
    <add key="BaseSiteUrl" value="https://democraticintelligence.org"/>

    <!-- After this period of inactivity, a user is considered inactive. -->
    <add key="UserActiveTime" value="14.00:00:00" />

    <!-- Points -->

    <!-- Taking tests -->
    <add key="PointsRequiredBeforeDeductingPoints" value="20" />
    <add key="PointsToDeductWhenStartingTest" value="20" />
    <add key="PointsForPassingATest" value="20" />
    <add key="MarkersRequiredPerTest" value="2" />
    <add key="PointsMarkersGainForAgreeingATestResult" value="10" />
    <add key="PointsMarkersLoseForDisagreeingATestResult" value="10" />

    <!-- A user is competent in a tag if any of the following are true:
    1. Their score is in the top MinPercentCompetents % of active users.  This needs to be reconsidered, since parent tags are not taken into account.
    2. Their score is in the top MinCompetents of active users.
    3. Their score is in the top CompetentPercentOfHighestScore % of the highest score for that tag for an active user.-->
    <add key="MinPercentCompetents" value="15" />
    <add key="MinCompetents" value="4" />
    <add key="CompetentPercentOfHighestScore" value="30" />

    <!-- A user is an expert in a tag if any of the following are true:
    1. Their score is in the top MinPercentExperts % of active users.  This needs to be reconsidered, since parent tags are not taken into account.
    2. Their score is in the top MinExperts of active users.
    3. Their score is in the top ExpertPercentOfHighestScore % of the highest score for that tag for an active user.-->
    <add key="MinPercentExperts" value="7" />
    <add key="MinExperts" value="2" />
    <add key="ExpertPercentOfHighestScore" value="65" />
    
    <add key="DiPointsForAcceptedTicket" value="2" />
    <add key="DiPointsForVolunteering" value="10" />
    <add key="DiPointsForFirstBadge" value="2" />

    <!-- Progressing tickets to next state -->
    <add key="MaxPositionToAdvanceState" value="2" />
    <add key="MinimumNumberOfArgumentsToAdvanceState" value="1" />
    <add key="MinimumNumberOfAnswersToAdvanceState" value="1" />
    <add key="PercentOfVotesRequiredToAccept" value="60" />

    <!-- Weightings to apply to arguments / answers of users based on knowledge level -->
    <add key="BeginnerWeighting" value="1" />
    <add key="CompetentWeighting" value="2" />
    <add key="ExpertWeighting" value="4" />

    <!-- Normal delays -->
    <add key="DelayAfterDiscussion" value="2.00:00" />
    <add key="DelayForVoting" value="4.00:00" />

    <!-- Technical configuration -->
    <add key="MinEventInterval" value="00:01:00" />
    <!-- Recommended setting: true for high traffic, false for low traffic -->
    <add key="RunEventsAsync" value="true" />

    <!-- Normal intervals -->
    <add key="CompleteDiscussionEventInterval" value="00:31:00" />
    <add key="CompleteVotingEventInterval" value="00:32:00"/>
    <add key="UpdateTagsEventInterval" value="04:00:00"/>

    <!-- Technical settings -->

    <!-- Email settings -->
    <add key="SmtpServer" value="smtpout.europe.secureserver.net"/>
    <add key="SmtpUsername" value="noreply@democraticintelligence.org"/>
    <add key="SmtpPassword" value="*********"/>
    <add key="DefaultFromAddress" value="noreply@democraticintelligence.org"/>
  </appSettings>
  <system.web>
    <compilation xdt:Transform="RemoveAttributes(debug)" />
    <!--
      In the example below, the "Replace" transform will replace the entire 
      <customErrors> section of your Web.config file.
      Note that because there is only one customErrors section under the 
      <system.web> node, there is no need to use the "xdt:Locator" attribute.
      
      <customErrors defaultRedirect="GenericError.htm"
        mode="RemoteOnly" xdt:Transform="Replace">
        <error statusCode="500" redirect="InternalError.htm"/>
      </customErrors>
    -->
  </system.web>
  <system.webServer xdt:Transform="Replace">
    <validation validateIntegratedModeConfiguration="false" />
    <handlers>
      <remove name="ExtensionlessUrlHandler-ISAPI-4.0_32bit" />
      <remove name="ExtensionlessUrlHandler-ISAPI-4.0_64bit" />
      <remove name="ExtensionlessUrlHandler-Integrated-4.0" />
      <add name="ExtensionlessUrlHandler-ISAPI-4.0_32bit" path="*." verb="GET,HEAD,POST,DEBUG,PUT,DELETE,PATCH,OPTIONS" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework\v4.0.30319\aspnet_isapi.dll" preCondition="classicMode,runtimeVersionv4.0,bitness32" responseBufferLimit="0" />
      <add name="ExtensionlessUrlHandler-ISAPI-4.0_64bit" path="*." verb="GET,HEAD,POST,DEBUG,PUT,DELETE,PATCH,OPTIONS" modules="IsapiModule" scriptProcessor="%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet_isapi.dll" preCondition="classicMode,runtimeVersionv4.0,bitness64" responseBufferLimit="0" />
      <add name="ExtensionlessUrlHandler-Integrated-4.0" path="*." verb="GET,HEAD,POST,DEBUG,PUT,DELETE,PATCH,OPTIONS" type="System.Web.Handlers.TransferRequestHandler" preCondition="integratedMode,runtimeVersionv4.0" />
    </handlers>
    <httpErrors errorMode="Custom" existingResponse="Replace">
      <remove statusCode="404" />
      <error statusCode="404" responseMode="ExecuteURL" path="/Home/PageNotFound" />
    </httpErrors>
    <rewrite>
      <rules>
        <rule name="HTTP to HTTPS redirect" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
            <add input="{HTTPS}" pattern="off" ignoreCase="true" />
          </conditions>
          <action type="Redirect" redirectType="Found" url="https://{HTTP_HOST}/{R:1}" />
        </rule>
      </rules>
    </rewrite>
  </system.webServer>  
</configuration>