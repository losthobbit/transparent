@model Transparent.Data.Models.TicketsContainer
@using Transparent.Extensions;
@using Transparent.Data.Models;

@{
    if (Model != null)
    {      
        <section>
            <header class="subMenu">
            @if(!ViewData.ContainsKey("ShowTicketTypeMenu") || (bool)ViewData["ShowTicketTypeMenu"])
            {
                foreach(var ticketType in ModelViewExtensions.TicketTypeInfo)
                {
                    if(Model.TicketType == ticketType.Type)
                    {
                        <span class="@ticketType.Type.GetClass()">@ticketType.PluralDisplayName</span>
                    }
                    else
                    {
                        @Html.ActionLink(ticketType.PluralDisplayName, ViewContext.RouteData.Values["action"].ToString(), Model.GetState(ticketType.Type), new {@class = ticketType.Type.GetClass()});
                    }
                }
            }
            @if (ViewData.ContainsKey("States"))
            {
                var states = (TicketState[])ViewData["States"];
                foreach (var state in states)
                {
                    if(Model.TicketState == state)
                    {
                        <span>@state.DisplayName()</span>
                    }
                    else
                    {
                        @Html.ActionLink(state.DisplayName(), ViewContext.RouteData.Values["action"].ToString(), Model.GetState(state));
                    }
                }
            }
            </header>
            <table>
            @foreach (var item in Model.PagedList)
            {
            <tr class="ticket @item.TicketType.GetClass()">
                <td>
                    @Html.DisplayFor(modelItem => item.Rank)
                </td>
                <td>@item.TicketType.GetChar()</td>
                <td class="metadata">@Html.DisplayFor(modelItem => item.State)</td>
                <td>
                    @Html.ActionLink(item.Heading, "Details", new { id=item.Id })
                    <div id="ticketTagsPartial" class="metadata">
                        @Html.Action("_TicketTags", new Transparent.Business.ViewModels.TicketTagsViewModel(item, true))
                    </div>
                </td>
                <td class="metadata">
                    @item.TextForCreated at @Html.DisplayFor(modelItem => item.CreatedDate)
                </td>
            </tr>
            }
            </table>
            @Html.Partial("_PagesPartial", Model)
        </section>
    }
}

